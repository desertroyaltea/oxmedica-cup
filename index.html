<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OXMEDICA Cup 2025</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-font: 'Poppins', sans-serif;
            --bg-color: #f8faff;
            --card-bg: #ffffff;
            --text-color: #4a5568;
            --heading-color: #1e3a8a;
            --subtle-text: #718096;
            --primary-color: #2b6cb0;
            --primary-hover: #1e4e8a;
            --success-bg: #e6fffa;
            --success-text: #38b2ac;
            --error-bg: #fff5f5;
            --error-text: #e53e3e;
            --info-bg: #ebf8ff;
            --info-text: #3182ce;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            --border-radius: 12px;
            --gold: #f6ad55;
            --silver: #cbd5e0;
            --bronze: #dd6b20;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        body { font-family: var(--primary-font); background-color: var(--bg-color); color: var(--text-color); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; box-sizing: border-box; }
        .container { max-width: 480px; width: 100%; text-align: center; }
        .page { display: none; animation: fadeIn 0.5s ease-out; }
        .page.active { display: block; }
        .card { background: var(--card-bg); padding: 45px 40px; border-radius: var(--border-radius); box-shadow: var(--shadow); }
        .form-header, .page-header { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 15px; margin-bottom: 40px; }
        .logo { width: 180px; height: 180px; object-fit: contain; }
        h1, h2 { margin: 0; color: var(--heading-color); font-weight: 700; }
        h1 { font-size: 2.2em; }
        h2 { font-size: 1.8em; }
        .form-group { margin-bottom: 25px; text-align: left; }
        .form-group label { display: block; margin-bottom: 10px; font-weight: 600; font-size: 0.95em; color: var(--heading-color); }
        select, input { width: 100%; padding: 16px; border-radius: 10px; border: 1px solid #e2e8f0; background-color: #fdfefe; box-sizing: border-box; font-size: 1em; transition: border-color 0.2s, box-shadow 0.2s; }
        select:focus, input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 4px rgba(43, 108, 176, 0.2); }
        .button { width: 100%; padding: 18px; border: none; border-radius: 10px; background-color: var(--primary-color); color: white; font-size: 1.15em; font-weight: 600; cursor: pointer; transition: all 0.3s ease-in-out; letter-spacing: 0.5px; text-transform: uppercase; }
        .button:hover { background-color: var(--primary-hover); transform: translateY(-3px); box-shadow: 0 8px 18px rgba(0,0,0,0.18); }
        .status-message { margin-top: 25px; min-height: 20px; font-weight: 500; padding: 15px 20px; border-radius: 8px; text-align: center; line-height: 1.4; }
        .status-message.info { background-color: var(--info-bg); color: var(--info-text); border: 1px solid #bee3f8; }
        .status-message.success { background-color: var(--success-bg); color: var(--success-text); border: 1px solid #90cdf4; }
        .status-message.error { background-color: var(--error-bg); color: var(--error-text); border: 1px solid #fbb6ce; }
        footer { margin-top: 40px; font-size: 0.9em; color: var(--subtle-text); }
        .credit { font-size: 0.8em; margin-top: 5px; }
        .back-button { margin-top: 30px; background-color: #a0aec0; }
        .back-button:hover { background-color: #718096; }
        .menu-buttons { display: flex; flex-direction: column; gap: 20px; }
        #welcome-message { font-size: 1.3em; font-weight: 500; color: var(--subtle-text); margin-top: 10px; margin-bottom: 40px; }
        #goto-cup { background-color: var(--gold); color: var(--heading-color); }
        #goto-cup:hover { background-color: #d69e2e; }
        .reader-container { background-color: var(--card-bg); border-radius: var(--border-radius); box-shadow: inset 0 0 10px rgba(0,0,0,0.05); overflow: hidden; border: 1px solid #e2e8f0; }
        .result-box { font-size: 1.25em; font-weight: 500; padding: 25px; border-radius: var(--border-radius); transition: all 0.3s ease-in-out; min-height: 80px; display: flex; align-items: center; justify-content: center; text-align: center; margin-bottom: 30px; }
        .button-group { display: flex; gap: 15px; margin-top: 30px; }
        .button.add { background-color: #38a169; }
        .button.add:hover { background-color: #2c7a52; }
        .button.remove { background-color: #e53e3e; }
        .button.remove:hover { background-color: #c53030; }
        #ra-balance { font-weight: 700; color: var(--heading-color); margin-bottom: 25px; font-size: 1.4em; background-color: #f0f4f7; padding: 15px 20px; border-radius: 8px; border: 1px solid #d1e0ed; }
        .ranking-type-selector { display: flex; justify-content: center; gap: 25px; margin-bottom: 30px; font-size: 1.05em; color: var(--text-color); }
        .ranking-type-selector label { display: flex; align-items: center; cursor: pointer; font-weight: 500; }
        .ranking-type-selector input[type="radio"] { margin-right: 10px; transform: scale(1.3); accent-color: var(--primary-color); }
        #leaderboard-display, #transcript-display, #quotes-view-display { margin-top: 30px; text-align: left; }
        .leaderboard-item, .transcript-item, .quote-item { padding: 18px; margin-bottom: 12px; background-color: #fdfdfe; border-radius: 10px; border: 1px solid #e9edf2; font-size: 1em; box-shadow: 0 4px 10px rgba(0,0,0,0.05); transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .leaderboard-item:hover, .transcript-item:hover, .quote-item:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .leaderboard-item { display: flex; align-items: center; }
        .leaderboard-item .rank { font-size: 1.5em; font-weight: 700; width: 60px; text-align: center; color: var(--subtle-text); }
        .leaderboard-item .name { font-weight: 600; flex-grow: 1; color: var(--heading-color); }
        .leaderboard-item .points { font-size: 1.3em; font-weight: 700; color: var(--primary-color); margin-left: 20px; }
        .leaderboard-item.rank-1 .rank { color: var(--gold); }
        .leaderboard-item.rank-2 .rank { color: var(--silver); }
        .leaderboard-item.rank-3 .rank { color: var(--bronze); }
        .transcript-item { line-height: 1.7; }
        .t-ra, .q-author { color: var(--primary-color); font-weight: 600; }
        .t-group { color: #dd6b20; }
        .t-reason, .q-quote { color: #38a169; }
        .t-points { font-weight: 700; color: var(--primary-color); }
        .loader { border: 5px solid #e2e8f0; border-top: 5px solid var(--primary-color); border-radius: 50%; width: 45px; height: 45px; animation: spin 1s linear infinite; margin: 30px auto; }
        hr { border: none; border-top: 1px solid #e2e8f0; margin: 40px 0; }
    </style>
</head>
<body>
    <div id="login-page" class="page active container">
        <div class="card"><div class="form-header"><img src="assets/logo.png" alt="OXMEDICA Logo" class="logo"><h1>OXMEDICA Cup 2025</h1></div><form id="login-form"><div class="form-group"><label for="username">Username</label><select id="username" name="username"><option>Loading users...</option></select></div><div class="form-group"><label for="password">Password</label><input type="password" id="password" name="password" required></div><button type="submit" class="button">Login</button><p id="login-error" class="status-message"></p></form></div>
        <footer><p class="credit">OXMEDICA 2025</p></footer>
    </div>

    <div id="menu-page" class="page container">
        <div class="card"><div class="page-header"><img src="assets/logo.png" alt="OXMEDICA Logo" class="logo"></div><p id="welcome-message"></p><div class="menu-buttons"><button id="goto-points" class="button">RA Points</button><button id="goto-quotes" class="button">Quotes</button><button id="goto-transcript" class="button">Transcript</button><button id="goto-cup" class="button">OXMEDICA Cup</button></div></div>
         <footer><p class="credit">OXMEDICA 2025</p></footer>
    </div>

    <div id="tutor-scanner-page" class="page container">
        <div class="card"><div class="page-header" style="gap: 20px;"><img src="assets/logo.png" alt="OXMEDICA Logo" class="logo" style="width: 120px; height: 120px;"><p id="tutor-welcome-message" style="font-size: 1.2em; font-weight: 600; margin: 0;"></p></div><section id="tutor-result" class="result-box info">Ready to scan...</section><section id="tutor-reader" class="reader-container"></section></div>
        <footer><p>OXMEDICA Cup 2025</p><p class="credit">OXMEDICA 2025</p></footer>
    </div>

    <div id="points-page" class="page container">
        <div class="card"><h2>RA Points</h2><p id="ra-balance">Your Balance: Loading...</p><div class="form-group"><label for="student-select">Select Student</label><select id="student-select" name="student-select"><option>Loading students...</option></select></div><div class="form-group"><label for="points-input">Points</label><input type="number" id="points-input" placeholder="e.g., 5" required></div><div class="form-group"><label for="reason-input">Reason</label><input type="text" id="reason-input" placeholder="e.g., Being an idiot" required></div><div class="button-group"><button id="add-points" class="button add">Add +</button><button id="remove-points" class="button remove">Remove -</button></div><p id="points-result" class="status-message"></p></div>
        <button class="button back-button">Back to Menu</button><footer><p class="credit">OXMEDICA 2025</p></footer>
    </div>
    
    <!-- Other pages remain the same... -->
    <div id="quotes-page" class="page container"> <div class="card"> <h2>Add a Quote</h2> <form id="add-quote-form"> <div class="form-group"><label for="quote-input">The Quote</label><input type="text" id="quote-input" required></div> <div class="form-group"><label for="author-input">Who said it?</label><input type="text" id="author-input" required></div> <button type="submit" class="button">Add Quote</button> <p id="quote-result" class="status-message"></p> </form> <hr> <h2>View Quotes</h2> <div class="form-group"><label for="quotes-date">Select Date</label><input type="date" id="quotes-date"></div> <div id="quotes-view-display"></div> </div> <button class="button back-button">Back to Menu</button> <footer><p class="credit">OXMEDICA 2025</p></footer> </div>
    <div id="cup-page" class="page container"> <div class="card"><h2>OXMEDICA Cup Rankings</h2><div class="ranking-type-selector"><label><input type="radio" name="rankingType" value="student" checked> Student</label><label><input type="radio" name="rankingType" value="group"> RA Group</label></div><div class="form-group"><label for="week-select">Select Week</label><select id="week-select"><option value="">-- Choose a week --</option><option value="Week2">Week 2</option><option value="Week3">Week 3</option></select></div><div id="leaderboard-display"></div></div> <button class="button back-button">Back to Menu</button><footer><p class="credit">OXMEDICA 2025</p></footer> </div>
    <div id="transcript-page" class="page container"> <div class="card"><h2>Daily Points Transcript</h2><div class="form-group"><label for="transcript-date">Select Date</label><input type="date" id="transcript-date"></div><div id="transcript-display"></div></div> <button class="button back-button">Back to Menu</button><footer><p class="credit">OXMEDICA 2025</p></footer> </div>

    <script src="https://unpkg.com/html5-qrcode"></script>
    <script>
        // --- GLOBAL VARIABLES ---
        const pages = document.querySelectorAll('.page');
        const loginForm = document.getElementById('login-form');
        const welcomeMessage = document.getElementById('welcome-message');
        const tutorWelcomeMessage = document.getElementById('tutor-welcome-message');
        const studentSelect = document.getElementById('student-select');
        const raBalanceEl = document.getElementById('ra-balance');
        const cupButton = document.getElementById('goto-cup');
        const usernameSelect = document.getElementById('username');

        let allUsers = [];
        let scanner = null;
        let loggedInUser = null;

        // --- CORE FUNCTIONS ---
        function showPage(pageId) {
            pages.forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }

        async function fetchAndPopulateUsers() {
            try {
                const response = await fetch('/.netlify/functions/get-users');
                if (!response.ok) throw new Error('Failed to fetch user list');
                allUsers = await response.json();
                
                usernameSelect.innerHTML = '';
                allUsers.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.username;
                    option.textContent = user.username;
                    usernameSelect.appendChild(option);
                });
            } catch (error) {
                console.error("User fetch error:", error);
                usernameSelect.innerHTML = '<option>Error loading users</option>';
            }
        }

        // --- EVENT LISTENERS ---
        document.addEventListener('DOMContentLoaded', fetchAndPopulateUsers);

        loginForm.addEventListener('submit', function(event) {
            event.preventDefault();
            const selectedUsername = usernameSelect.value;
            const password = document.getElementById('password').value;
            const errorEl = document.getElementById('login-error');

            const user = allUsers.find(u => u.username === selectedUsername);

            if (user && user.password === password) {
                loggedInUser = user;
                const selectedText = usernameSelect.options[usernameSelect.selectedIndex].text;
                
                if (user.type.toLowerCase() === 'tutor') {
                    tutorWelcomeMessage.textContent = `Welcome Tutor ${selectedText}!`;
                    showPage('tutor-scanner-page');
                    startScanner('tutor-reader', 'tutor-result');
                } else {
                    let title = user.type; // Should be "RA" or "Lead RA"
                    welcomeMessage.textContent = `Welcome ${title} ${selectedText}!`;
                    
                    cupButton.style.display = user.type.toLowerCase() === 'lead ra' ? 'block' : 'none';
                    showPage('menu-page');
                }
            } else {
                errorEl.textContent = 'Invalid username or password.';
            }
        });

        document.getElementById('goto-points').addEventListener('click', () => { showPage('points-page'); fetchRaBalance(); if (studentSelect.options.length <= 1) { populateStudents(); } });
        document.getElementById('goto-cup').addEventListener('click', () => { showPage('cup-page'); });
        document.getElementById('goto-transcript').addEventListener('click', () => { const dateInput = document.getElementById('transcript-date'); if (!dateInput.value) { dateInput.value = new Date(new Date().toLocaleString('en-US', { timeZone: 'Asia/Riyadh' })).toISOString().split('T')[0]; } fetchTranscript(); showPage('transcript-page'); });
        document.getElementById('goto-quotes').addEventListener('click', () => { const dateInput = document.getElementById('quotes-date'); if (!dateInput.value) { dateInput.value = new Date(new Date().toLocaleString('en-US', { timeZone: 'Asia/Riyadh' })).toISOString().split('T')[0]; } fetchQuotes(); showPage('quotes-page'); });
        document.querySelectorAll('.back-button').forEach(button => { button.addEventListener('click', () => { if (scanner) { try { scanner.clear(); } catch(e) {} scanner = null; } showPage('menu-page'); }); });
        
        // --- All other functions remain the same ---
        const addQuoteForm = document.getElementById('add-quote-form');
        const quoteResultEl = document.getElementById('quote-result');
        const quotesDateInput = document.getElementById('quotes-date');
        const quotesViewDisplay = document.getElementById('quotes-view-display');
        addQuoteForm.addEventListener('submit', async function(event) { event.preventDefault(); const quoteInput = document.getElementById('quote-input'); const authorInput = document.getElementById('author-input'); quoteResultEl.className = 'status-message info'; quoteResultEl.textContent = 'Adding quote...'; try { const response = await fetch('/.netlify/functions/add-quote', { method: 'POST', body: JSON.stringify({ quote: quoteInput.value, author: authorInput.value, recorderName: loggedInUser.username }) }); const data = await response.json(); quoteResultEl.textContent = data.message; quoteResultEl.className = `status-message ${data.status}`; if (data.status === 'success') { quoteInput.value = ''; authorInput.value = ''; fetchQuotes(); } } catch (error) { quoteResultEl.textContent = 'Error communicating with server.'; quoteResultEl.className = 'status-message error'; } });
        async function fetchQuotes() { const selectedDate = quotesDateInput.value; if (!selectedDate) { quotesViewDisplay.innerHTML = ''; return; } quotesViewDisplay.innerHTML = '<div class="loader"></div>'; try { const response = await fetch('/.netlify/functions/get-quotes', { method: 'POST', body: JSON.stringify({ date: selectedDate }) }); if (!response.ok) throw new Error('Failed to fetch quotes'); const data = await response.json(); renderQuotes(data); } catch (error) { quotesViewDisplay.innerHTML = '<p class="error">Could not load quotes.</p>'; } }
        quotesDateInput.addEventListener('change', fetchQuotes);
        function renderQuotes(data) { quotesViewDisplay.innerHTML = ''; if (data.length === 0) { quotesViewDisplay.innerHTML = '<p>No quotes found for this date.</p>'; return; } data.forEach(entry => { const item = document.createElement('div'); item.className = 'quote-item'; item.innerHTML = `<span class="q-author">${entry.author}:</span> <span class="q-quote">"${entry.quote}"</span>`; quotesViewDisplay.appendChild(item); }); }
        const transcriptDateInput = document.getElementById('transcript-date');
        const transcriptDisplay = document.getElementById('transcript-display');
        async function fetchTranscript() { const selectedDate = transcriptDateInput.value; if (!selectedDate) { transcriptDisplay.innerHTML = ''; return; } transcriptDisplay.innerHTML = '<div class="loader"></div>'; try { const response = await fetch('/.netlify/functions/get-transcript', { method: 'POST', body: JSON.stringify({ date: selectedDate }) }); if (!response.ok) throw new Error('Failed to fetch transcript'); const data = await response.json(); renderTranscript(data); } catch (error) { transcriptDisplay.innerHTML = '<p class="error">Could not load transcript.</p>'; } }
        transcriptDateInput.addEventListener('change', fetchTranscript);
        function renderTranscript(data) { transcriptDisplay.innerHTML = ''; if (data.length === 0) { transcriptDisplay.innerHTML = '<p>No points transactions found for this date.</p>'; return; } data.forEach(entry => { const item = document.createElement('div'); item.className = 'transcript-item'; item.innerHTML = ` <span class="t-ra">RA ${entry.raName}</span> gave <span class="t-group">${entry.studentRaGroup}</span> <b class="t-points">${entry.points} points</b> for: <span class="t-reason">"${entry.reason}"</span> `; transcriptDisplay.appendChild(item); }); }
        const weekSelect = document.getElementById('week-select');
        const leaderboardDisplay = document.getElementById('leaderboard-display');
        const rankingTypeRadios = document.querySelectorAll('input[name="rankingType"]');
        async function fetchRankings() { const selectedWeek = weekSelect.value; const selectedType = document.querySelector('input[name="rankingType"]:checked').value; if (!selectedWeek) { leaderboardDisplay.innerHTML = ''; return; } leaderboardDisplay.innerHTML = '<div class="loader"></div>'; try { const response = await fetch('/.netlify/functions/get-cup-ranking', { method: 'POST', body: JSON.stringify({ week: selectedWeek, type: selectedType }) }); if (!response.ok) throw new Error('Failed to fetch rankings'); const data = await response.json(); renderLeaderboard(data, selectedType); } catch (error) { leaderboardDisplay.innerHTML = '<p class="error">Could not load rankings.</p>'; } }
        weekSelect.addEventListener('change', fetchRankings);
        rankingTypeRadios.forEach(radio => radio.addEventListener('change', fetchRankings));
        function renderLeaderboard(data, type) { leaderboardDisplay.innerHTML = ''; if (data.length === 0) { leaderboardDisplay.innerHTML = '<p>No points data found for this week.</p>'; return; } data.forEach((item, index) => { const rank = index + 1; const leaderboardItem = document.createElement('div'); leaderboardItem.className = `leaderboard-item rank-${rank}`; leaderboardItem.innerHTML = `<div class="rank">#${rank}</div><div class="name">${item.name}</div><div class="points">${item.points} pts</div>`; leaderboardDisplay.appendChild(leaderboardItem); }); }
        async function populateStudents() { try { const response = await fetch('/.netlify/functions/get-students'); if (!response.ok) throw new Error('Network response was not ok'); const students = await response.json(); studentSelect.innerHTML = ''; students.forEach(student => { const option = document.createElement('option'); option.value = student; option.textContent = student; studentSelect.appendChild(option); }); } catch (error) { studentSelect.innerHTML = '<option>Could not load students</option>'; } }
        async function fetchRaBalance() { raBalanceEl.textContent = 'Your Balance: Loading...'; if (!loggedInUser) { raBalanceEl.textContent = 'Your Balance: Error - Not logged in.'; return; } try { const response = await fetch('/.netlify/functions/get-ra-balance', { method: 'POST', body: JSON.stringify({ raName: loggedInUser.username }) }); if (!response.ok) { const errorText = await response.text(); throw new Error(`Failed to fetch balance. Server responded with: ${response.status} ${errorText}`); } const data = await response.json(); if (typeof data.balance !== 'undefined') { raBalanceEl.textContent = `Your Balance: ${data.balance} Points`; } else { throw new Error('Balance not found in server response.'); } } catch (error) { console.error("fetchRaBalance Error:", error); raBalanceEl.textContent = 'Your Balance: Could not load.'; } }
        async function handlePoints(action) { const studentName = studentSelect.value; const points = document.getElementById('points-input').value; const reason = document.getElementById('reason-input').value; const resultEl = document.getElementById('points-result'); if (!points || parseInt(points) <= 0) { resultEl.className = 'status-message error'; resultEl.textContent = 'Please enter a valid number of points.'; return; } if (!reason.trim()) { resultEl.className = 'status-message error'; resultEl.textContent = 'A reason is required.'; return; } resultEl.className = 'status-message info'; resultEl.textContent = `${action === 'add' ? 'Adding' : 'Removing'} points...`; try { const response = await fetch('/.netlify/functions/manage-points', { method: 'POST', body: JSON.stringify({ studentName, points: parseInt(points), action, reason, raName: loggedInUser.username }) }); const data = await response.json(); resultEl.textContent = data.message; resultEl.className = `status-message ${data.status}`; if (data.status === 'success') { fetchRaBalance(); } } catch (error) { resultEl.textContent = 'Error communicating with server.'; resultEl.className = 'status-message error'; } }
        document.getElementById('add-points').addEventListener('click', () => handlePoints('add'));
        document.getElementById('remove-points').addEventListener('click', () => handlePoints('remove'));
        function startScanner(readerId, resultId) { if (scanner) { try { scanner.clear(); } catch(e) {} scanner = null; } const resultDiv = document.getElementById(resultId); let isProcessing = false; async function onScanSuccess(decodedText) { if (isProcessing) return; isProcessing = true; resultDiv.textContent = `Processing: ${decodedText}...`; resultDiv.className = 'result-box info'; try { const response = await fetch('/.netlify/functions/log-attendance', { method: 'POST', body: JSON.stringify({ studentId: decodedText }) }); const data = await response.json(); resultDiv.textContent = data.message; resultDiv.className = `result-box info ${data.status}`; } catch (error) { resultDiv.textContent = 'Error communicating with server.'; resultDiv.className = 'result-box info error'; } setTimeout(() => { isProcessing = false; resultDiv.textContent = 'Ready for next scan...'; resultDiv.className = 'result-box info'; }, 4000); } scanner = new Html5QrcodeScanner(readerId, { fps: 10, qrbox: { width: 250, height: 250 } }, false); scanner.render(onScanSuccess, () => {}); }
    </script>
</body>
</html>
```

### **2. `get-users.js`**

This function now correctly points to the `RAs` sheet.


```javascript
const { google } = require('googleapis');

exports.handler = async function (event) {
    try {
        const auth = new google.auth.GoogleAuth({
            credentials: {
                client_email: process.env.GOOGLE_CLIENT_EMAIL,
                private_key: process.env.GOOGLE_PRIVATE_KEY.replace(/\\n/g, '\n'),
            },
            scopes: ['https://www.googleapis.com/auth/spreadsheets.readonly'],
        });

        const sheets = google.sheets({ version: 'v4', auth });
        const spreadsheetId = process.env.GOOGLE_SHEET_ID;
        const sheetName = 'RAs'; // Corrected to use RAs sheet

        const response = await sheets.spreadsheets.values.get({
            spreadsheetId,
            range: `${sheetName}!E2:G`,
        });

        const rows = response.data.values || [];
        const users = rows.map(row => {
            if (row[0] && row[1] && row[2]) {
                return {
                    username: row[0].trim(),
                    password: row[1].trim(),
                    type: row[2].trim(),
                };
            }
            return null;
        }).filter(user => user !== null);

        return {
            statusCode: 200,
            body: JSON.stringify(users),
        };

    } catch (error) {
        console.error('Function Error:', error);
        return {
            statusCode: 500,
            body: JSON.stringify({ message: `An error occurred while fetching users: ${error.message}` }),
        };
    }
};
